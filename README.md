# AI-Town

AI-Town 是一个基于人工智能技术的虚拟小镇模拟项目，通过先进的AI模型驱动NPC（非玩家角色）与玩家进行自然对话和互动。该项目结合了Godot游戏引擎和Python后端，为用户提供了一个沉浸式的AI社交体验。

## 项目概述

AI-Town 旨在创建一个具有自主行为和记忆能力的虚拟环境。每个NPC都具备独特的个性、背景故事和对话能力，能够与玩家进行有意义的交流，并随着时间推移建立关系。玩家可以在小镇中自由探索，与不同角色互动，体验个性化的故事线。

## 技术架构



AI-Town 采用前后端分离的架构设计，结合了现代游戏开发技术和AI驱动系统：



### 前端 (Godot Engine)

- **游戏引擎**: Godot 4.x (基于C++的开源游戏引擎)

- **脚本语言**: GDScript (静态类型语言，类似Python语法)

- **主要功能模块**:

  - 2D游戏界面渲染与场景管理

  - 玩家角色移动和交互控制系统

  - NPC行为展示与动画管理

  - 对话界面UI设计与交互管理

  - RESTful API通信与数据同步

  - 音频与视觉资源管理

- **技术特点**:

  - 高效的2D渲染管线

  - 节点(Node)驱动的组件化架构

  - 信号(Signal)机制实现松耦合通信

  - 内置动画系统与资源管理器

  - 角色移动系统 (CharacterBody2D物理控制)

  - 区域检测系统 (Area2D交互范围)

  - 配置管理与调试系统



### 后端 (Python生态)

- **Web框架**: FastAPI (高性能异步Web框架)

- **AI框架**: HelloAgents (自主AI智能体框架)

- **核心模块**:

  - `agents.py`: NPC智能体管理系统与对话引擎 - 实现基于角色设定的AI对话

  - `batch_generator.py`: 批量对话内容生成器 - 优化API使用效率，降低调用成本

  - `relationship_manager.py`: 智能关系和亲和力管理系统 - 使用LLM分析情感并动态调整NPC态度

  - `state_manager.py`: NPC状态机与行为管理 - 异步定时更新NPC状态与对话

  - `memory_data/`: 多维记忆数据存储系统 - 实现NPC长期记忆与交互历史

  - `config.py`: 项目配置与环境变量管理

  - `logger.py`: 日志记录与调试系统

- **核心技术包**:

  - FastAPI (>=0.104.0) - 高性能异步Web框架

  - Uvicorn (>=0.24.0) - ASGI应用服务器

  - Pydantic (>=2.0.0) - 数据验证与序列化

  - Requests (>=2.31.0) - HTTP客户端库

  - python-multipart (>=0.0.6) - 表单数据处理

  - HelloAgents (>=0.2.4) - AI智能体框架

  - Pytest (>=7.4.0) + Httpx (>=0.25.0) - 测试框架与工具

  - Python标准库 (os, json, datetime, asyncio等)

- **高级功能特性**:

  - 高效异步编程 (asyncio实现后台任务)

  - 情感分析与动态关系管理

  - 记忆系统 (短期和长期记忆管理)

  - 角色个性化 (基于职位、性格、专业技能的个性化对话)

  - 批量处理优化 (一次API调用生成多NPC对话)



### 系统架构特点

- **全栈开发**: 前后端分离架构，独立部署与维护

- **AI驱动**: 基于自主AI智能体实现NPC智能行为

- **响应式设计**: 实时对话与状态同步

- **持久化存储**: 本地文件系统实现数据持久化

- **模块化设计**: 高内聚低耦合的设计模式

- **可扩展架构**: 支持动态添加NPC和新功能模块

## 安装与使用

### 环境要求
- Python 3.8+
- Godot Engine 4.x
- pip

### 后端安装步骤

1. 克隆项目：
   ```bash
   git clone <repository-url>
   cd AI-Town/backend
   ```

2. 创建虚拟环境并激活：
   ```bash
   python -m venv venv
   # Windows
   venv\Scripts\activate
   # Linux/Mac
   source venv/bin/activate
   ```

3. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

4. 配置环境变量（可选）：
   ```bash
   # 创建 .env 文件并配置 API 密钥等
   cp .env.example .env
   # 编辑 .env 文件
   ```

5. 启动后端服务：
   ```bash
   uvicorn main:app --reload
   ```

### 前端设置步骤

1. 打开 Godot Engine
2. 导入 `ai-town/` 目录作为项目
3. 在 Godot 编辑器中运行项目，或导出为可执行文件

#### API 接口



后端提供以下RESTful API接口，支持前后端分离架构的高效通信：

- `POST /chat/{npc_name}` - 与指定NPC进行AI对话，支持记忆和关系系统

- `GET /npcs` - 获取所有NPC列表及其基本信息

- `GET /npcs/{npc_name}` - 获取指定NPC的详细信息

- `GET /npcs/{npc_name}/memories` - 获取NPC的记忆数据和对话历史

- `GET /npcs/{npc_name}/affinity` - 获取NPC与玩家的亲和力/关系状态

- `GET /npcs/status` - 获取NPC批量状态更新（定时任务生成的对话）

- `GET /health` - 服务健康检查接口

- `POST /npcs/{npc_name}/affinity` - 设置NPC与玩家的亲和力（用于调试）



前端通过GDScript的HTTPRequest节点与后端API进行通信，实现数据的实时同步和交互。

## 项目特点



### AI驱动的NPC智能系统

- **个性化NPC**: 每个NPC都有独特的个性、背景故事和对话能力

- **智能对话系统**: 基于HelloAgents框架实现自然语言对话

- **记忆功能**: 具备长期记忆能力，能够记住与玩家的交互历史

- **自主行为**: NPC具备自主决策能力，可独立执行行动



### 高级关系管理系统

- **亲和力系统**: 动态计算和更新NPC与玩家的关系亲密度

- **情感分析**: AI分析对话内容并调整NPC对玩家的态度

- **关系持久化**: 智能关系数据本地存储与恢复

- **社交网络**: 实现NPC间的社交关系网络



### 沉浸式交互体验

- **2D游戏界面**: 支持玩家自由移动与环境探索

- **实时对话系统**: 即时响应的AI对话交互

- **动态NPC行为**: NPC具有自主移动、随机对话等行为模式

- **多感官反馈**: 集成音频与视觉反馈系统



### 高性能架构设计

- **前后端分离**: 清晰的职责划分与独立部署能力

- **异步通信**: FastAPI异步处理API请求，提高响应效率

- **模块化设计**: 高内聚低耦合的模块化架构

- **可扩展架构**: 支持动态添加NPC和功能模块



### 数据管理与持久化

- **记忆数据库**: 本地文件系统实现NPC记忆数据持久化

- **状态管理**: NPC状态机管理与持久化存储

- **对话历史**: 完整的对话记录与检索系统

- **关系图谱**: 智能关系网络数据管理

### 开发规范

- 保持代码风格一致
- 为新功能添加适当测试
- 更新文档（如果需要）
- 确保所有测试通过

### 代码结构

- `ai-town/` - Godot前端代码
- `backend/` - Python后端代码
- `backend/agents.py` - AI智能体核心逻辑
- `backend/relationship_manager.py` - 关系管理逻辑
- `ai-town/script/` - Godot脚本文件

### 技术创新

- **AI智能体集成**: 成功将HelloAgents框架与游戏引擎集成，实现了AI驱动的NPC行为

- **实时对话引擎**: 构建了高效、低延迟的实时对话系统

- **关系感知系统**: 开发了动态关系管理系统，使NPC具有情感和记忆能力


### 技术能力展示

- **全栈开发**: 熟练掌握前端游戏开发与后端API开发

- **AI集成**: 具备AI框架集成与应用开发经验

- **游戏开发**: 熟悉Godot引擎与2D游戏开发流程

- **异步编程**: 使用FastAPI实现高性能异步Web服务

- **数据建模**: 设计并实现了复杂的状态管理和数据持久化系统



### 项目规模与复杂度

- **代码量**: 全栈项目，包含前端游戏逻辑与后端AI服务

- **系统复杂度**: 多模块集成，包括AI对话、关系管理、状态管理等

- **创新性**: 结合游戏开发与AI技术，实现虚拟社交体验



### 核心技术亮点

- **AI集成**：成功集成HelloAgents框架，实现基于角色设定的个性化AI对话

- **关系感知系统**：使用LLM分析情感并动态调整NPC态度，提升沉浸感

- **记忆系统**：实现短期和长期记忆管理，NPC可记住与玩家的交互历史

- **批量处理优化**：通过批量API调用降低服务成本，优化性能

- **前后端分离**：清晰的架构设计，支持独立开发和部署

- **实时通信**：通过API实现前后端数据实时同步，保证用户体验

- **异步编程**：使用asyncio实现后台任务处理，提高系统响应性

- **组件化设计**：Godot引擎的节点系统实现高度模块化的游戏逻辑



## 许可证



本项目采用 MIT 许可证 - 详情请参阅 [LICENSE](LICENSE) 文件。



## 致谢



- 感谢 HelloAgents 框架提供了强大的AI集成能力

- 感谢 Godot Engine 提供了优秀的2D游戏开发环境

- 感谢所有为项目做出贡献的开发者
